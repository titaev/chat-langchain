<!DOCTYPE html>
<html>
  <head>
    <title>WebSocket Streaming Test</title>
  </head>
  <body>
   <button id="send-btn">Send Message</button>
    <ul id="messages"></ul>
    <script>
      const messagesEl = document.getElementById('messages');
      const socket = new WebSocket('ws://0.0.0.0:9000/chat/v2/lead_form/0c45d798-7d90-4b64-b1c1-eaac2f464791');

      socket.addEventListener('open', (event) => {
        console.log('WebSocket connection established');
      });

      socket.addEventListener('message', (event) => {
        const data = JSON.parse(event.data);
          console.log(data)
        if (data.type === 'stream') {
          const message = data.text;
          const li = document.createElement('li');
          li.textContent = message;
          messagesEl.appendChild(li);
        } else if (data.type === 'result') {
          console.log('Received final result:', data.text);
        }
      });

      const sendBtn = document.getElementById('send-btn');

      sendBtn.addEventListener('click', (event) => {
        const message = 'Новый проект двух певцов и одного ресторатора. Правда ли, что официанты ходят здесь голыми, а подачи блюд настолько фантастичны, что их хочется запечатлеть?\n' +
            '\n' +
            'Свежее Gucci Cafe (Москва, ул. Новый Арбат, 15) под предводительством рэпера Тимати и великого певца Егора Крида в сотрудничестве с ресторатором Антоном Пинским открылось вчера, но привлекло к себе внимание гораздо раньше тем, что без зазрения совести назвалось именем итальянского бренда, чем последний, естественно, остался недоволен. А остались ли довольны обедом НЕБОРЩИ? Об этом дальше.\n' +
            '\n' +
            'Рейтинг на Яндекс.Картах — отсутствует, так как ресторан только-только открылся.\n' +
            '\n' +
            'Gucci Cafe →\n' +
            'Заведение заработало по соседству с другим рестораном Тимати «Red Box», а ещё буквально в пяти шагах отсюда находятся его небезызвестная дебютная бургерная «Black Star Burger», куда когда-то выстраивались толпы, и наш ответ ушедшему «Старбаксу» в лице «Stars Coffee» - в этом проекте Тимур Юнусов также выступает соучредителем.\n' +
            '\n' +
            'Заранее столики в Gucci Cafe не бронируют, вся рассадка происходит в порядке живой очереди.\n' +
            'После обеда, несмотря на первый полноценный день существования места, она заметно рассасывается. Столики освобождаются, мы устраиваемся поудобней и оглядываемся вокруг.\n' +
            'Gucci Cafe →\n' +
            'Заведение заработало по соседству с другим рестораном Тимати «Red Box», а ещё буквально в пяти шагах отсюда находятся его небезызвестная дебютная бургерная «Black Star Burger», куда когда-то выстраивались толпы, и наш ответ ушедшему «Старбаксу» в лице «Stars Coffee» - в этом проекте Тимур Юнусов также выступает соучредителем.\n' +
            '\n' +
            'Заранее столики в Gucci Cafe не бронируют, вся рассадка происходит в порядке живой очереди.\n' +
            'После обеда, несмотря на первый полноценный день существования места, она заметно рассасывается. Столики освобождаются, мы устраиваемся поудобней и оглядываемся вокруг.';
        socket.send(JSON.stringify({ text: message }));
      });
    </script>
  </body>
</html>





